<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lumos ‚Äî –±—ã—Å—Ç—Ä—ã–π –º–æ–±–∏–ª—å–Ω—ã–π –ø–æ–∏—Å–∫</title>
  <meta name="description" content="Lumos ‚Äî –ª—ë–≥–∫–∏–π –º–æ–±–∏–ª—å–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤–∏–∫. –ú—ã —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞–µ–º —Å DuckDuckGo –∏ –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏." />
  <link rel="manifest" href="https://github.com/Jeff-creator801/Lumos/blob/main/manifest.json">
  <meta name="theme-color" content="#ffffff">

  <style>
    /* =========== –û–±—â–∞—è —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–∞ =========== */
    :root{
      --bg: #ffffff;
      --accent: #ffd428; /* –∂—ë–ª—Ç–∞—è –∫–Ω–æ–ø–∫–∞ / –ª–∏–º–æ–Ω */
      --muted: #666b72;
      --input-border: #e5e7eb;
      --card: #ffffff;
      --radius: 12px;
      --maxw: 760px;
      font-family: Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:#111827;
    }
    /* layout center */
    .page {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:36px 18px;
      box-sizing:border-box;
    }

    .container{
      width:100%;
      max-width:var(--maxw);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:18px;
    }

    header {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
    }

    /* Lemon logo (big) */
    .logo {
      width:88px;
      height:88px;
      border-radius:22px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(135deg, #fff6d6, #ffe78e);
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      font-size:42px;
      line-height:1;
    }
    h1{margin:0;font-size:22px;letter-spacing:0.2px;}
    p.subtitle{margin:0;color:var(--muted);font-size:14px;}

    /* Search box centered */
    .search-wrap{
      width:100%;
      display:flex;
      justify-content:center;
    }

    .search-card{
      width:100%;
      max-width:650px;
      background:var(--card);
      border-radius:16px;
      padding:18px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.04);
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:stretch;
    }

    .search-row{
      display:flex;
      width:100%;
      gap:8px;
      align-items:center;
    }

    input.search {
      flex:1;
      padding:14px 16px;
      font-size:16px;
      border-radius:10px;
      border:1px solid var(--input-border);
      outline:none;
      box-sizing:border-box;
      color:#0f1720;
    }
    input.search:focus{
      box-shadow:0 6px 20px rgba(16,24,40,0.06);
      border-color:#d6d8dc;
    }

    button.btn-search {
      background:var(--accent);
      border:none;
      padding:12px 16px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 8px 20px rgba(255, 212, 40, 0.14);
      transition: transform .08s ease;
    }
    button.btn-search:active{ transform: translateY(1px); }

    /* Results area */
    .results{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:4px;
    }
    .card{
      padding:12px;
      border-radius:10px;
      background:#fafafa;
      border:1px solid #f0f0f0;
      font-size:14px;
      color:#0b1220;
    }
    .instant-title{ font-weight:700; margin-bottom:6px; }
    .instant-desc{ color:var(--muted); font-size:13px; }

    .links { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
    .link-btn {
      padding:8px 10px;
      border-radius:8px;
      background:transparent;
      border:1px solid #eef0f2;
      color:var(--muted);
      text-decoration:none;
      font-size:13px;
      display:inline-block;
    }

    .footer{
      margin-top:10px;
      text-align:center;
      color:var(--muted);
      font-size:13px;
    }

    /* responsive tweaks */
    @media(max-width:520px){
      .logo{ width:72px;height:72px;font-size:34px;border-radius:14px; }
      .search-card{ padding:12px; }
      input.search{ padding:12px 10px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <main class="container" role="main" aria-labelledby="site-title">
      <header>
        <div class="logo" aria-hidden>üçã</div>
        <h1 id="site-title">Lumos</h1>
        <p class="subtitle">–ë—ã—Å—Ç—Ä—ã–π –º–æ–±–∏–ª—å–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤–∏–∫</p>
      </header>

      <section class="search-wrap" aria-label="–ü–æ–∏—Å–∫">
        <div class="search-card" role="region" aria-label="–ü–æ–∏—Å–∫–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div style="font-size:13px;color:var(--muted);">–ò—Å–∫–∞—Ç—å –≤ Lumos</div>
            <div style="font-size:12px;color:var(--muted);">–ñ–∏–≤–æ–π –ø–æ–∏—Å–∫ ¬∑ PWA-ready</div>
          </div>

          <div class="search-row" style="margin-top:6px;">
            <input id="q" class="search" aria-label="–ü–æ–ª–µ –ø–æ–∏—Å–∫–∞" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∏ –Ω–∞–∂–º–∏—Ç–µ –ü–æ–∏—Å–∫ –∏–ª–∏ Enter" />
            <button id="go" class="btn-search" aria-label="–ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞">–ü–æ–∏—Å–∫</button>
          </div>

          <div id="status" style="font-size:13px;color:var(--muted);">–ì–æ—Ç–æ–≤ –∫ –ø–æ–∏—Å–∫—É</div>

          <div id="results" class="results" aria-live="polite"></div>
        </div>
      </section>

      <div class="footer" id="footer-note">
        –ú—ã —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞–µ–º —Å DuckDuckGo –∏ –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.
      </div>
    </main>
  </div>

  <script>
  /*
    Lumos ‚Äî –∂–∏–≤–æ–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ DuckDuckGo Instant Answer (JSONP).
    –ü–æ–≤–µ–¥–µ–Ω–∏–µ:
      - –ü—Ä–∏ –≤–≤–æ–¥–µ –∏ Enter / –∫–Ω–æ–ø–∫–µ "–ü–æ–∏—Å–∫" –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è JSONP –∑–∞–ø—Ä–æ—Å –∫ DuckDuckGo API.
      - –ï—Å–ª–∏ Instant Answer –Ω–∞–π–¥–µ–Ω ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º, –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Å—Å—ã–ª–∫–∞–º–∏.
      - –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º fallback-–∫–Ω–æ–ø–∫–∏ –¥–ª—è DuckDuckGo / Google / Bing.
      - –í—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫ –∏ —Ç–∞–π–º–∞—É—Ç.
    –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
      - –ú—ã –Ω–µ –º–æ–∂–µ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥—Ä—É–≥–∏—Ö —Å–∞–π—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –í–∏–∫–∏–ø–µ–¥–∏–∏) –Ω–∞ Lumos –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
        –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–µ–Ω —Å–≤–æ–π –±—Ä–∞—É–∑–µ—Ä/WebView –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.
  */

  (function(){
    const qInput = document.getElementById('q');
    const goBtn = document.getElementById('go');
    const statusEl = document.getElementById('status');
    const resultsEl = document.getElementById('results');

    // Escape text to avoid XSS when inserting via innerHTML in safe places.
    function escapeHtml(s){
      const d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }

    // Render fallback links to external search engines
    function renderFallback(query){
      resultsEl.innerHTML = '';
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<div class="instant-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è ¬´${escapeHtml(query)}¬ª</div>
        <div class="instant-desc">–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ:</div>`;
      const links = document.createElement('div');
      links.className = 'links';
      const qEnc = encodeURIComponent(query);
      const engines = [
        {name:'DuckDuckGo', url:`https://duckduckgo.com/?q=${qEnc}`},
        {name:'Google', url:`https://www.google.com/search?q=${qEnc}`},
        {name:'Bing', url:`https://www.bing.com/search?q=${qEnc}`}
      ];
      engines.forEach(e=>{
        const a = document.createElement('a');
        a.className = 'link-btn';
        a.target = '_blank';
        a.rel = 'noopener';
        a.href = e.url;
        a.textContent = e.name;
        links.appendChild(a);
      });
      card.appendChild(links);
      resultsEl.appendChild(card);
    }

    // Render DuckDuckGo Instant Answer data
    function renderInstant(data, query){
      resultsEl.innerHTML = '';
      const card = document.createElement('div');
      card.className = 'card';

      const title = data.Heading || (data.AbstractText ? query : '');
      if(title){
        const h = document.createElement('div');
        h.className = 'instant-title';
        h.textContent = title;
        card.appendChild(h);
      }

      if(data.AbstractText){
        const d = document.createElement('div');
        d.className = 'instant-desc';
        d.textContent = data.AbstractText;
        card.appendChild(d);
      }

      // Source link
      if(data.AbstractURL){
        const src = document.createElement('div');
        src.style.marginTop = '8px';
        const a = document.createElement('a');
        a.className = 'link-btn';
        a.href = data.AbstractURL;
        a.target = '_blank';
        a.rel = 'noopener';
        a.textContent = '–û—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫';
        src.appendChild(a);
        card.appendChild(src);
      }

      // Related topics (if any)
      if(Array.isArray(data.RelatedTopics) && data.RelatedTopics.length){
        const related = document.createElement('div');
        related.style.marginTop = '10px';
        related.className = 'links';
        // collect up to 6 links
        let count = 0;
        function pushTopic(t){
          if(count >= 6) return;
          if(t.Text && t.FirstURL){
            const a = document.createElement('a');
            a.className = 'link-btn';
            a.href = t.FirstURL;
            a.target = '_blank';
            a.rel = 'noopener';
            a.textContent = t.Text;
            related.appendChild(a);
            count++;
          } else if(Array.isArray(t.Topics)){
            t.Topics.forEach(inner => pushTopic(inner));
          }
        }
        data.RelatedTopics.forEach(rt => pushTopic(rt));
        if(related.childElementCount) card.appendChild(related);
      }

      // Always add fallback engine links
      const fallback = document.createElement('div');
      fallback.className = 'links';
      fallback.style.marginTop = '12px';
      const qEnc = encodeURIComponent(query);
      ['DuckDuckGo','Google','Bing'].forEach(name=>{
        const a = document.createElement('a');
        a.className = 'link-btn';
        a.target = '_blank';
        a.rel = 'noopener';
        if(name === 'DuckDuckGo') a.href = `https://duckduckgo.com/?q=${qEnc}`;
        if(name === 'Google') a.href = `https://www.google.com/search?q=${qEnc}`;
        if(name === 'Bing') a.href = `https://www.bing.com/search?q=${qEnc}`;
        a.textContent = name;
        fallback.appendChild(a);
      });
      card.appendChild(fallback);

      resultsEl.appendChild(card);
    }

    // JSONP helper for DuckDuckGo Instant Answer (uses callback param)
    function duckDuckGoInstant(query, timeoutMs = 7000){
      return new Promise((resolve, reject) => {
        const cbName = 'lumos_dd_cb_' + Math.floor(Math.random()*1e9);
        const script = document.createElement('script');
        const url = 'https://api.duckduckgo.com/?q=' + encodeURIComponent(query) + '&format=json&no_html=1&skip_disambig=1&callback=' + cbName;
        let timer = setTimeout(() => {
          cleanup();
          reject(new Error('timeout'));
        }, timeoutMs);

        window[cbName] = function(data){
          clearTimeout(timer);
          cleanup();
          resolve(data || {});
        };
        script.src = url;
        script.onerror = function(){
          clearTimeout(timer);
          cleanup();
          reject(new Error('network'));
        };
        function cleanup(){
          try{ delete window[cbName]; }catch(e){}
          if(script.parentNode) script.parentNode.removeChild(script);
        }
        document.head.appendChild(script);
      });
    }

    // Main search function
    async function doSearch(query){
      if(!query || !query.trim()) return;
      const q = query.trim();
      statusEl.textContent = '–ò—â–µ–º ‚Üí ' + q;
      resultsEl.innerHTML = '<div class="card">–ò–¥—ë—Ç –ø–æ–∏—Å–∫...</div>';
      try {
        const data = await duckDuckGoInstant(q);
        // If there's definitely no useful instant content, fallback
        const hasUseful = (data && (data.AbstractText || data.Heading || (Array.isArray(data.RelatedTopics) && data.RelatedTopics.length)));
        if(hasUseful){
          statusEl.textContent = '–ì–æ—Ç–æ–≤–æ';
          renderInstant(data, q);
        } else {
          statusEl.textContent = '–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω';
          renderFallback(q);
        }
      } catch(err){
        // network or timeout -> fallback
        statusEl.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–∏—Å–∫ –≤ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–∏—Å–µ';
        renderFallback(q);
      }
    }

    // UX handlers
    goBtn.addEventListener('click', () => doSearch(qInput.value));
    qInput.addEventListener('keydown', (e) => {
      if(e.key === 'Enter') doSearch(qInput.value);
    });

    // optional: live search while typing (debounced)
    let debounceTimer = null;
    qInput.addEventListener('input', () => {
      // comment/uncomment the block below to enable/disable live search as-you-type
      clearTimeout(debounceTimer);
      const val = qInput.value;
      if(!val || val.length < 2) {
        // clear results to avoid spam
        // resultsEl.innerHTML = '';
        return;
      }
      debounceTimer = setTimeout(() => {
        doSearch(val);
      }, 700); // 700 ms debounce
    });

    // PWA install prompt UI
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      // show a temporary install hint in UI
      const hint = document.createElement('button');
      hint.className = 'btn-search';
      hint.style.marginTop = '8px';
      hint.textContent = '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Lumos';
      hint.onclick = async () => {
        if(!deferredPrompt) return;
        deferredPrompt.prompt();
        const choice = await deferredPrompt.userChoice;
        deferredPrompt = null;
        hint.remove();
      };
      // append if not already present
      const card = document.querySelector('.search-card');
      if(card && !card.querySelector('.install-hint')) {
        hint.classList.add('install-hint');
        card.appendChild(hint);
      }
    });

    // focus input on load for mobile convenience
    setTimeout(() => qInput.focus(), 300);

    // Service worker registration (if supported)
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js').catch(()=>{/* ignore */});
    }

  })();
  </script>
</body>
</html>
